# ‚ö†Ô∏è CRITICAL CHECKLIST - Read Before Creating Pull Request

**STOP! Complete this checklist before running `gh pr create` or `/create-pr`:**

---

## Prerequisites

- ‚úÖ Code written and tested
- ‚úÖ Changes committed (following `CRITICAL-BEFORE-COMMIT.md`)
- ‚úÖ Working on feature branch (NOT master/main/maintenance-*)

---

## üö® TESTING IS MANDATORY

**NEVER create a pull request without testing the code.**

### Required Testing Steps

1. **Code Must Compile**
   - Use **inav-builder** agent to verify build succeeds

2. **Code Must Actually Run**
   - Don't just verify it compiles
   - Actually execute and test the functionality
   - Use **test-engineer** agent or SITL for firmware changes

3. **Feature Must Work**
   - Test the specific feature/fix works as expected
   - Verify expected behavior occurs

4. **Test Edge Cases**
   - Try invalid inputs
   - Test with empty data
   - Test boundary conditions

5. **Verify No Regressions**
   - Check that existing functionality still works
   - Run related tests

### If Testing Isn't Possible

If you genuinely cannot test (no hardware, blocked dependencies):
1. **Be explicit in PR description** - state what you couldn't test and why
2. **Request testing** - ask for someone with hardware/setup to test
3. **Never claim "tested" if you didn't actually test**

**Remember:** Untested code can brick expensive flight hardware.

---

## üö® CODE REVIEW IS MANDATORY

**Use the `inav-code-review` agent before creating your PR.**

```
Task tool with subagent_type="inav-code-review"
Prompt: "Review changes in [files] - [brief description]"
```

**What the review checks:**
- Coding standards compliance
- Embedded systems safety (ISR safety, memory constraints, stack usage)
- INAV-specific patterns (PG system, scheduler, hardware abstraction)
- Common pitfalls (integer overflow, volatile misuse, race conditions)
- Over-engineering and unnecessary complexity
- Flight-critical code path safety

**Address issues found:**
- Fix CRITICAL issues (must fix before merge)
- Fix IMPORTANT issues (should fix before merge)
- Consider MINOR issues (nice to have)

---

## üîç Finalize End-User Documentation

**If you drafted user documentation before coding (see CRITICAL-BEFORE-CODE.md step 4):**

1. **Update the draft** in `claude/developer/workspace/[task-name]/draft-user-docs.md`
   - Verify it matches the actual implementation
   - Update examples and configuration steps if they changed
   - Ensure CLI/settings changes are accurate

2. **Add documentation to the codebase:**
   - Technical docs ‚Üí `inav/docs/` (committed with PR)
   - End-user guides ‚Üí `inavwiki/` (separate PR to wiki repo if needed)

3. **Mention in PR description:**
   - List which documentation files were added/updated
   - Or note "Documentation not needed (bug fix/target/refactor)"

---

## Creating the Pull Request

### 1. Review Changes

Determine your base branch:
- **INAV backward-compatible:** `maintenance-9.x`
- **INAV breaking changes:** `maintenance-10.x`
- **PrivacyLRS:** `secure_01`
- **Never PR to master**

Then review:
```bash
git status
git diff maintenance-9.x...HEAD  # or maintenance-10.x or secure_01
git log maintenance-9.x..HEAD    # or maintenance-10.x or secure_01
```

### 2. Verify All Changes Committed
```bash
git status  # Should show "nothing to commit, working tree clean"
```

If uncommitted changes exist, commit them first (see `CRITICAL-BEFORE-COMMIT.md`).

### 3. Push to Remote
```bash
git push -u origin branch-name
```

### 4. Create PR

Use `/create-pr` skill or:
```bash
gh pr create --title "Title" --body "Description"
```
IMPORTANT **Never open a pull request to the master branch**

**PR Description Requirements:**

**Include:**
- Summary of changes
- Testing performed (be specific - what did you test and what were the results)
- Code review performed (mention using inav-code-review agent)
- Related issue number (if applicable)

**Do NOT mention:**
- Claude or AI assistance
- "Generated by" statements

**Example:**
```markdown
## Summary
Fixes blackbox corruption when no motors are defined in the mixer.

## Changes
- Added motor count validation in blackbox logger
- Return early if motor count is zero

## Testing
- Built SITL target successfully
- Tested with custom mixer with 0 motors - no corruption
- Tested with standard quad mixer - blackbox works normally
- Verified existing blackbox functionality unchanged

## Code Review
Reviewed with inav-code-review agent - no critical issues found.

Fixes #1234
```

---

## After Creating PR

**This is step 10 in the workflow. See `/check-builds` skill or `check-pr-bots` agent.**

Quick summary:
1. Wait 3 minutes for bots to analyze
2. Use **check-pr-bots** agent or **/check-builds** skill
3. Review and address bot suggestions

---

## Self-Improvement: Lessons Learned

When you discover something important about PR CREATION AND TESTING that will likely help in future sessions, add it to this section. Only add insights that are:
- **Reusable** - will apply to future PR creation, not one-off situations
- **About PRs/testing** - testing requirements, PR workflow, bot checking, CI/CD
- **Concise** - one line per lesson

Use the Edit tool to append new entries. Format: `- **Brief title**: One-sentence insight`

### Lessons

<!-- Add new lessons above this line -->
