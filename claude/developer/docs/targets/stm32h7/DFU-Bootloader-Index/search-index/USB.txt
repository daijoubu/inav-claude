Keyword: USB
Occurrences: 892
================================================================================

Page 1: the available serial peripherals (such as USART, CAN, USB, I2C, I3C, SPI, FDCAN). A
Page 5: 19.3.4      PA9 excessive power consumption when USB cable is plugged
Page 17: 93.3     USB connection timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 495
Page 22: Table 211.   USB bootloader minimum timings (ms) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 496
Page 23: Figure 2.    USB connection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44
Page 25: Figure 123. USB connection timing description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 496
Page 26: –     AN3156: USB DFU protocol used in the STM32 bootloader
Page 34: In some products using interrupts (integrating USB, SPI, non auto baud rate USART),
Page 35: USB) communication protocol used in the bootloader. This version can be retrieved
Page 35: X = 15: USART, USB-DFU, I2C, and I3C are used
Page 35: X = 16: USART, USB-DFU, FDCAN, and SPI are used
Page 36: USB DFU                                           USB (V2.2)
Page 36: STM32F04xxx                       DFU (USB device FS)            0xA1    0x1FFFF6A6 DFU (V2.2)
Page 36: F0       STM32F071xx/072xx                 DFU (USB device FS)            0xA1    0x1FFFF6A6 DFU (V2.2)
Page 36: STM32F070x6                       DFU (USB device FS)            0xA2    0x1FFFF6A6 DFU (V2.2)
Page 36: STM32F070xB                       DFU (USB device FS)            0xA3    0x1FFFF6A6 DFU (V2.2)
Page 36: DFU (USB device)
Page 37: DFU (USB device FS)                              DFU (V2.2)
Page 37: DFU (USB device FS)                                DFU (V2.2)
Page 37: DFU (USB device FS)                                DFU (V2.2)
Page 37: DFU (USB device FS)                                DFU (V2.2)
Page 37: DFU (USB device FS)                                DFU (V2.2)
Page 38: DFU (USB device FS)                              DFU (V2.2)
Page 38: DFU (USB device FS)            0x91   0x1FFF77DE DFU (V2.2)
Page 38: DFU (USB device FS)                              DFU (V2.2)
Page 38: DFU (USB device FS)            0x91   0x1FFF76DE DFU (V2.2)
Page 38: DFU (USB device FS)                              DFU (V2.2)
Page 38: DFU (USB device FS)                                DFU (V2.2)
Page 38: DFU (USB device FS)                                DFU (V2.2)
Page 38: STM32F412xx                 DFU (USB device FS)            0x91   0x1FFF76DE DFU (V2.2)
Page 38: STM32F413xx/423xx           DFU (USB device FS)            0x90   0x1FFF76DE DFU (V2.2)
Page 38: STM32F446xx                 DFU (USB device FS)            0x90   0x1FFF76DE DFU (V2.2)
Page 38: DFU (USB device FS)                              DFU (V2.2)
Page 39: STM32F72xxx/73xxx           DFU (USB device FS)            0x90   0x1FF0EDBE DFU (V2.2)
Page 39: DFU (USB device FS)                                DFU (V2.2)
Page 39: DFU (USB device FS)                              DFU (V2.2)
Page 39: STM32F76xxx/77xxx           DFU (USB device FS)            0x93   0x1FF0EDBE DFU (V2.2)
Page 39: DFU (USB device FS)                              DFU (V2.2)
Page 39: DFU (USB device FS)                              DFU (V2.2)
Page 39: DFU (USB device FS)                                DFU (V2.2)
Page 39: DFU (USB device FS)                              DFU (V2.2)
Page 39: DFU (USB device FS)                              DFU (V2.2)
Page 40: USB DFU                                            USB (V3.0)
Page 40: USB DFU                                            USB (V3.0)
Page 40: USB DFU                                            USB (V3.0)
Page 40: STM32H72xxx/73xxx           DFU (USB device FS)             0x93    0x1FF1E7FE DFU (V2.2)
Page 40: STM32H74xxx/75xxx           DFU (USB device FS)             0x92    0x1FF1E7FE DFU (V2.2)
Page 40: STM32H7A3xx/7B3xx/7B0xx     DFU (USB device FS)             0x92    0x1FF13FFE DFU (V2.2)
Page 40: STM32H7Rxxx/7Sxxx           DFU (USB device FS)                    0x1FF1FCFE DFU (V2.2)
Page 41: DFU (USB device FS)                                DFU (V2.2)
Page 41: DFU (USB device FS)                                DFU (V2.2)
Page 41: DFU (USB device FS)                                DFU (V2.2)
Page 41: DFU (USB device FS)                                DFU (V2.2)
Page 42: DFU (USB device FS)
Page 42: DFU (USB device FS)                              DFU (V2.2)
Page 42: DFU (USB device FS)                              DFU (V2.2)
Page 42: DFU (USB device FS)                              DFU (V2.2)
Page 42: DFU (USB device FS)                              DFU(V2.2)
Page 42: DFU (USB device FS)                              DFU (V2.2)
Page 42: DFU (USB device FS)                              DFU (V2.2)
Page 42: DFU (USB device FS)                              DFU (V2.2)
Page 42: DFU (USB device FS)                              DFU (V2.2)
Page 42: DFU (USB device FS)                              DFU (V2.2)
Page 43: DFU (USB device FS)                              DFU (V3.0)
Page 43: DFU (USB device FS)                              DFU (V2.2)
Page 43: DFU (USB device FS)                              DFU (V2.2)
Page 43: DFU (USB device HS)                              DFU (V2.2)
Page 43: DFU (USB device HS)                              DFU (V2.2)
Page 43: DFU (USB device FS)                              DFU (V2.2)
Page 43: DFU (USB device FS)                               DFU (V3.0)
Page 44: To use the DFU, connect the microcontroller USB interface to a USB host (such as a PC).
Page 44: Figure 2. USB connection
Page 44: USB Host
Page 46: Note:      When a bootloader firmware supports DFU, it is mandatory that no USB host is connected
Page 46: to the USB peripheral during the selection phase of the other interfaces. After selection
Page 46: phase, the user can plug a USB cable without impacting the selected bootloader execution,
Page 46: SPI_MOSI, and CAN_RX, if present) at a known (low or high) level and keep the USB D+/D-
Page 66: bootloader so that USB can be clocked by HSI48 48 MHz
Page 67: USB FS configured in forced device mode. USB FS interrupt
Page 67: USB                  Enabled
Page 67: vector is enabled and used for USB DFU communications.
Page 67: PA11: USB DM line. Used in alternate push-pull, no pull
Page 67: DFU           USB_DM pin
Page 67: PA12: USB DP line. Used in alternate push-pull, no pull
Page 67: USB_DP pin
Page 68: used for the USB.
Page 68: and HSI48 for USB
Page 68: USB FS device
Page 68: USB cable
Page 68: USB interrupts
Page 81: allow USB to be clocked by HSI48 48 MHz.
Page 82: USB                  Enabled        USB used in FS mode
Page 82: PA11: USB DM line. Used in alternate push-pull, no pull
Page 82: USB_DM pin
Page 82: Input/output   PA12: USB DP line
Page 82: USB_DP pin                          No external pull-up resistor is required. Used in alternate
Page 83: Configure USB FS device
Page 83: USB
Page 83: bootloader using USB                                 Execute
Page 84: – USB bootloader fails on some machines using a high speed controller. The bootloader
Page 84: Add dynamic     De-synchronization between USB controller and bootloader SW due to the controller
Page 84: USART/USB       for the bootloader SW (based on interrupt routines) to serve all needed transactions
Page 84: packages        Add USB HUB between host and the MCU. This relaxes transactions inter-packet
Page 84: delay, and allows the BL SW to perform correctly the task. Use USB controller/host that
Page 85: 8, 6, 4 MHz. The PLL is used to generate 48 MHz for USB
Page 85: USB FS configured in forced device mode. USB FS
Page 85: USB                  Enabled         interrupt vector is enabled and used for USB DFU
Page 85: USB_DM pin                           PA11 pin: USB FS DM line
Page 85: Input/output    PA12 pin: USB FS DP line.
Page 85: USB_DP pin
Page 87: Configure USB
Page 87: USB cable
Page 87: bootloader using USB       BL_I2C_Loop for          BL_USART_Loop
Page 87: Detected & USB
Page 88: – USB bootloader fails on some machines using a high speed controller. The
Page 88: De-synchronization between USB controller and bootloader SW due to the
Page 88: Add USB HUB between host and the MCU. This relaxes transactions inter-
Page 88: packet delay, and allows the BL SW to perform correctly the task. Use USB
Page 89: 8, 6, 4 MHz. The PLL is used to generate 48 MHz for USB
Page 90: USB FS configured in forced device mode. USB FS
Page 90: USB                  Enabled        interrupt vector is enabled and used for USB DFU
Page 90: DFU                                                 PA11 pin: USB FS DM line used in alternate push-pull, no
Page 90: USB_DM pin
Page 90: PA12 pin: USB FS DP line used in alternate push-pull, no
Page 90: USB_DP pin
Page 91: Configure USB
Page 91: USB cable
Page 91: bootloader using USB       BL_I2C_Loop for           BL_USART_Loop
Page 91: Detected & USB
Page 92: – USB bootloader fails on some machines using a high speed controller. The
Page 92: De-synchronization between USB controller and bootloader SW due to the
Page 92: Add USB HUB between host and the MCU. This relaxes transactions inter-
Page 92: packet delay, and allows the BL SW to perform correctly the task. Use USB
Page 93: CRS is enabled for the DFU to allow USB to be clocked by
Page 94: USB                   Enabled        USB used in FS mode
Page 94: PA11: USB DM line. Used in alternate push-pull, no pull
Page 94: USB_DM pin
Page 94: Input/output   PA12: USB DP line
Page 94: USB_DP pin                           No external pull-up resistor is required. Used in alternate
Page 95: Configure USB FS device
Page 95: USB
Page 95: bootloader using USB                                Execute
Page 96: – USB bootloader fails on some machines using a high speed controller. The bootloader
Page 96: De-synchronization between USB controller and bootloader SW due to the controller
Page 96: Add USB HUB between host and the MCU. This relaxes transactions inter-packet
Page 96: delay, and allows the BL SW to perform correctly the task. Use USB controller/host
Page 102: This is used only for USARTx and during CAN2, USB
Page 103: USB                   Enabled            USB OTG FS configured in forced device mode
Page 103: USB_VBUS pin          Input              PA9: Power supply voltage line
Page 103: DFU             USB_DM pin                               PA11 pin: USB_DM line
Page 103: Input/output       PA12 pin: USB_DP line.
Page 103: USB_DP pin
Page 104: Configure USB
Page 104: USB cable
Page 104: yes                                                     USB clock to 48 MHz
Page 104: no   bootloader using USB
Page 105: – DFU: USB pending interrupt cleared before executing the Leave DFU
Page 107: 19.3.4   PA9 excessive power consumption when USB cable is plugged
Page 107: When connecting a USB cable after booting from System-Memory mode, PA9 pin
Page 110: •    V3.x supporting USART1, USART3, CAN2, and DFU (USB FS device)
Page 113: HSE enabled DFU (USB FS device) interfaces are selected.
Page 114: USB                   Enabled        USB OTG FS configured in forced device mode
Page 114: USB_DM pin                           PA11: USB DM line. Used in input no pull mode.
Page 114: Input/output   PA12: USB DP line. Used in inpt no pull mode.
Page 114: USB_DP pin
Page 114: internal clock is also used for CAN and DFU (USB FS device), but only for the selection
Page 115: Configure USB OTG FS
Page 115: USB cable
Page 115: USB clock to 48 MHz
Page 115: bootloader using USB                               CANx
Page 117: The PLL is used to generate the USB48 MHz clock and the
Page 118: USB                  Enabled        USB used in FS mode
Page 118: PA11: USB DM line. Used in alternate push-pull, no pull
Page 118: USB_DM pin
Page 118: Input/output   PA12: USB DP line. Used in alternate push-pull, no pull
Page 118: USB_DP pin
Page 118: USB_DP pin.
Page 119: Configure USB FS device
Page 119: USB cable
Page 119: Detected & USB
Page 119: no                                            Execute                   bootloader using USB
Page 120: – USB bootloader fails on some machines using a high speed controller. The bootloader
Page 120: De-synchronization between USB controller and bootloader SW due to the controller
Page 120: Add USB HUB between host and the MCU. This relaxes transactions inter-packet
Page 120: delay, and allows the BL SW to perform correctly the task. Use USB controller/host
Page 121: The PLL is used to generate the USB 48 MHz clock and
Page 122: USB                   Enabled        USB used in FS mode
Page 122: PA11: USB DM line. Used in alternate push-pull, no pull
Page 122: USB_DM pin
Page 122: Input/output   PA12: USB DP line. Used in alternate push-pull, no pull
Page 122: USB_DP pin
Page 122: USB_DP pin.
Page 123: Configure USB
Page 123: USB configured
Page 123: Disable all       bootloader using USB
Page 124: The PLL is used to generate the USB 48 MHz clock and
Page 124: USB FS configured in forced device mode. USB FS
Page 124: USB                  Enabled          interrupt vector is enabled and used for USB DFU
Page 124: PA11 pin: USB FS DM line. Used in alternate push-pull, no
Page 124: DFU                USB_DM pin
Page 124: Input/output     PA12 pin: USB FS DP line. Used in alternate push-pull, no
Page 124: USB_DP pin                            pull mode. An external pull-up resistor 1.5 KΩ must be
Page 124: connected to USB_DP pin.
Page 126: Configure USB FS device
Page 126: USB cable
Page 126: detected & USB                                         yes
Page 126: BL_USART_Loop for         bootloader using USB
Page 127: – The USB bootloader fails on some machines using a high speed
Page 127: De-synchronization between USB controller and bootloader SW due to
Page 127: Add an USB HUB between the host and the MCU. This relaxes
Page 127: the task. Use USB controller/host that increase inter-packet delay.
Page 135: The PLL is used to generate the USB 48 MHz clock and the
Page 136: USB                  Enabled         USB used in FS mode
Page 136: PA11: USB DM line. Used in alternate push-pull, no pull
Page 136: USB_DM pin
Page 136: Input/output    PA12: USB DP line. Used in alternate push-pull, no pull
Page 136: USB_DP pin                           mode. An external pull-up resistor 1.5 KΩ must be
Page 136: connected to USB_DP pin.
Page 137: Configure USB
Page 137: USB configured
Page 137: yes         Disable all        bootloader using USB
Page 138: – The USB bootloader fails on some machines using a high speed controller. The
Page 138: De-synchronization between USB controller and bootloader SW due to the
Page 138: Add an USB HUB between the host and the MCU. This relaxes transactions
Page 138: USB controller/host that increase inter-packet delay.
Page 144: HSE enabled      the DFU (USB FS device) interfaces are selected.
Page 145: USB                  Enabled          USB OTG FS configured in forced device mode
Page 145: PA11: USB DM line. Used in alternate push-pull, no pull
Page 145: USB_DM pin
Page 145: PA12: USB DP line. Used in alternate push-pull, no pull
Page 145: USB_DP pin
Page 145: internal clock is also used for CAN and DFU (USB FS device), but only for the selection
Page 146: Configure USB OTG FS
Page 146: USB cable
Page 146: USB clock to 48 MHz
Page 146: bootloader using USB                               CANx
Page 148: HSE enabled DFU (USB FS device) interfaces are selected.
Page 150: USB                   Enabled         USB OTG FS configured in forced device mode
Page 150: PA11: USB DM line. Used in alternate push-pull, no pull
Page 150: USB_DM pin
Page 150: PA12: USB DP line. Used in alternate push-pull, no pull
Page 150: USB_DP pin
Page 150: and SPIx bootloaders. This internal clock is also used for CAN and DFU (USB FS device),
Page 151: Configure USB OTG FS
Page 151: USB cable
Page 151: Disable all interrupt   USB clock to 48 MHz                       interrupt sources
Page 151: Detected                     I2Cx                 USB interrupts
Page 153: RCC                               The HSE clock source is used only when the DFU (USB FS
Page 155: USB                   Enabled        USB OTG FS configured in forced device mode
Page 155: PA11: USB DM line. Used in alternate push-pull, no pull
Page 155: USB_DM pin
Page 155: DFU                                                  PA12: USB DP line. Used in alternate push-pull, no pull
Page 155: USB_DP pin
Page 155: and SPIx bootloaders. This internal clock is also used for CAN and DFU (USB FS device),
Page 156: Configure USB OTG FS
Page 156: USB cable                                                HSE detected          no
Page 156: I2Cx Address                                          USB clock to 48 MHz
Page 156: yes                           bootloader using USB
Page 158: The HSE clock source is used only when the DFU (USB
Page 160: USB                   Enabled        USB OTG FS configured in forced device mode
Page 160: PA11: USB DM line. Used in alternate push-pull, no pull
Page 160: USB_DM pin
Page 160: Input/output   PA12: USB DP line. Used in alternate push-pull, no pull
Page 160: DFU              USB_DP pin                           mode.
Page 160: and SPIx bootloaders. This internal clock is also used for DFU (USB FS device), but only for
Page 161: Configure USB OTG FS
Page 161: USB cable                                                HSE detected          no
Page 161: I2Cx Address                                          USB clock to 48 MHz
Page 161: yes                           bootloader using USB
Page 168: The HSE clock source is used only when the DFU (USB FS
Page 170: USB                 Enabled         USB OTG FS configured in forced device mode
Page 170: USB_DM pin                          PA11: USB DM line. Used in alternate push-pull, no pull mode.
Page 170: Input/output    PA12: USB DP line. Used in alternate push-pull, no pull mode.
Page 170: DFU          USB_DP pin
Page 170: I2Cx, and SPIx bootloaders. This internal clock is also used for DFU (USB FS device), but
Page 171: Configure USB OTG FS
Page 171: USB cable                                                HSE detected          no
Page 171: I2Cx Address                                          USB clock to 48 MHz
Page 171: yes                           bootloader using USB
Page 173: The HSE is used only when the CAN or the DFU (USB FS
Page 176: USB                  Enabled        USB OTG FS configured in forced device mode
Page 176: PA11 pin: USB DM line. Used in alternate push-pull, no pull
Page 176: USB_DM pin
Page 176: PA12 pin: USB DP line. Used in alternate push-pull, no pull
Page 176: USB_DP pin
Page 176: I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but
Page 177: Configure USB OTG FS
Page 177: USB clock to 48 MHz
Page 177: bootloader using USB
Page 177: USB cable                                    interrupts                                       Execute
Page 179: The HSE is used only when the CAN or the DFU (USB FS
Page 182: USB                   Enabled        USB OTG FS configured in forced device mode
Page 182: PA11 pin: USB DM line. Used in alternate push-pull, no
Page 182: USB_DM pin
Page 182: Input/output   PA12 pin: USB DP line. Used in alternate push-pull, no
Page 182: USB_DP pin                           pull mode.
Page 182: I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but
Page 183: Configure USB OTG FS
Page 183: USB clock to 48 MHz
Page 183: bootloader using USB
Page 183: USB cable                                       interrupts                                    Execute
Page 185: CAN or the DFU (USB FS device) interfaces
Page 187: USB OTG FS configured in forced device
Page 187: USB                   Enabled
Page 187: PA11: USB DM line. Used in alternate push
Page 187: USB_DM pin
Page 187: Input/output     PA12: USB DP line. Used in alternate push
Page 187: USB_DP pin                             pull no pull mode.
Page 187: I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but
Page 189: Configure USB OTG FS                       Disable all
Page 189: USB cable                    clock to 60MHz and
Page 189: Detected                    USB clock to 48 MHz                         Configure CAN
Page 189: bootloader using USB                      BL_CAN_Loop for
Page 190: For the USB DFU interface, in Dual Bank mode, the
Page 191: HSE enabled the DFU (USB FS device) interfaces are selected.
Page 193: USB                   Enabled        USB OTG FS configured in forced device mode
Page 193: PA11: USB DM line. Used in alternate push-pull no
Page 193: USB_DM pin
Page 193: Input/output   PA12: USB DP line. Used in alternate push-pull no
Page 193: USB_DP pin                           pull mode.
Page 194: I2Cx, and SPIx bootloaders. This internal clock is also used for CAN and DFU (USB FS
Page 196: Configure USB OTG FS
Page 196: USB cable                   clock to 60MHz and
Page 196: Detected                   USB clock to 48 MHz
Page 196: bootloader using USB                                  BL_CAN_Loop for
Page 197: For the USB DFU interface, in Dual Bank mode, the
Page 197: I2C No-stretch commands (I2C           For the USB DFU interface, in Dual Bank mode, the
Page 197: command for all protocols(USB,         After executing Go command (jump to user code)
Page 198: DFU (USB FS device) interfaces are
Page 201: USB OTG FS configured in forced device
Page 201: USB                   Enabled
Page 201: PA11: USB DM line. Used in alternate
Page 201: USB_DM pin
Page 201: Input/output        PA12: USB DP line. Used in alternate push-
Page 201: USB_DP pin                                pull, no pull mode.
Page 201: I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but
Page 202: Configure USB OTG FS device
Page 202: USB cable                   USB clock to 48 MHz                                     Configure CAN
Page 202: bootloader using USB                                   BL_CAN_Loop for
Page 204: the CAN or the DFU (USB FS device)
Page 207: USB OTG FS configured in forced device
Page 207: mode. USB_OTG_FS interrupt vector is
Page 207: USB                   Enabled
Page 207: enabled and used for USB DFU
Page 207: DFU                                                               PA11 pin: USB DM line. Used in alternate
Page 207: USB_DM pin
Page 207: Input/output        PA12 pin: USB DP line. Used in alternate
Page 207: USB_DP pin                                push-pull, no pull mode.
Page 207: I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but
Page 209: Configure USB OTG FS
Page 209: USB clock to 48 MHz
Page 209: USB cable                          bootloader using USB
Page 211: or the DFU (USB FS device) interfaces
Page 214: USB OTG FS configured in forced
Page 214: USB                     Enabled
Page 214: PA11 pin: USB DM line. Used in
Page 214: USB_DM pin
Page 214: Input/output              PA12 pin: USB DP line. Used in
Page 214: USB_DP pin                                        alternate push-pull, no pull mode.
Page 214: I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but
Page 217: •    V7.x supporting USART1, USART3, CAN2, I2C1, I2C2, I2C3, and DFU (USB FS
Page 217: DFU (USB FS device). This version is embedded in STM32F74xxx/75xxx rev. Z and
Page 217: The HSE is used only when the CAN or the DFU (USB FS
Page 219: USB                   Enabled        USB OTG FS configured in forced device mode.
Page 219: PA11 pin: USB DM line. Used in alternate push-pull, no
Page 219: USB_DM pin
Page 219: Input/output   PA12 pin: USB DP line. Used in alternate push-pull, no
Page 219: USB_DP pin                           pull mode.
Page 219: I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but
Page 220: Configure USB OTG FS                                                        interfaces clocks
Page 220: USB clock to 48 MHz
Page 220: USB cable
Page 220: bootloader using USB
Page 221: The HSE is used only when the CAN or the DFU (USB FS
Page 224: USB                   Enabled        USB OTG FS configured in forced device mode.
Page 224: PA11 pin: USB DM line. Used in alternate push-pull, no
Page 224: USB_DM pin
Page 224: PA12 pin: USB DP line. Used in alternate push-pull, no
Page 224: USB_DP pin
Page 224: I2Cx, and SPIx bootloaders. This internal clock is also used for CAN and DFU (USB FS
Page 225: Configure USB OTG FS
Page 225: USB clock to 48 MHz
Page 225: bootloader using USB
Page 225: USB cable                                   interrupts                                    Execute
Page 227: The HSE is used only when the CAN or the DFU (USB FS
Page 230: USB                  Enabled      USB OTG FS configured in forced device mode
Page 230: PA11 pin: USB DM line. Used in alternate push-pull, no pull
Page 230: USB_DM pin
Page 230: Input/output PA12 pin: USB DP line. Used in alternate push-pull, no pull
Page 230: USB_DP pin                        mode.
Page 230: I2Cx bootloaders. This internal clock is also used for CAN and DFU (USB FS device), but
Page 232: Configure USB OTG FS
Page 232: USB clock to 48 MHz
Page 232: bootloader using USB
Page 232: USB cable
Page 233: Bank2 sector erase issue when using USB
Page 243: 48 MHz for USB and system clock.
Page 245: USB FS configured in Forced Device mode. USB
Page 245: FS interrupt vector is enabled and used for USB
Page 245: USB                        Enabled          DFU communications.
Page 245: Note: VDDUSB IO must be connected to 3.3 V as
Page 245: DFU(2)                                                               USB peripheral is used by the bootloader.‘
Page 245: USB_DM pin                                  PA11: USB DM line. Used in input no pull mode.
Page 245: Input/output     PA12: USB DP line. Used in input no pull mode.
Page 245: USB_DP pin
Page 245: 2. USB DFU is not available on LQFP32 package.
Page 246: Configure USB
Page 246: USB cable                                                      Execute DFU
Page 246: detected and USB                                               bootloader using USB
Page 248: RCC                                 CRS is enabled for the DFU to allow USB to be clocked
Page 250: USB FS configured in Forced device mode. USB FS
Page 250: interrupt vector is enabled and used for USB DFU
Page 250: USB                      Enabled        communications.
Page 250: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 250: USB_DM pin                              PA11: USB DM line. Used in no pull mode.
Page 250: Input/output PA12: USB DP line. Used in no pull mode.
Page 250: USB_DP pin
Page 251: Configure USB OTG FS device
Page 251: Synchro mechanism            yes                               bootloader using USB
Page 251: USB cable          yes
Page 257: CRS is enabled for the DFU to allow USB to be clocked
Page 259: USB FS configured in forced device mode.
Page 259: USB                         Enabled         USB FS interrupt vector is enabled and used for USB
Page 259: USB_DM pin                                  PA11: USB DM line. Used in input no pull mode.
Page 259: Input/output    PA12: USB DP line. Used in input no pull mode. No
Page 259: USB_DP pin
Page 260: Configure USB Device FS
Page 260: bootloader using USB
Page 260: USB cable               yes
Page 262: CRS is enabled for the DFU to allow USB to be
Page 264: USB FS configured in forced device mode.
Page 264: USB FS interrupt vector is enabled and used for
Page 264: USB                        Enabled          USB DFU communications.
Page 264: Note: VDDUSB IO must be connected to 3.3 V as
Page 264: DFU                                                                  USB peripheral is used by the bootloader.
Page 264: USB_DM pin                                  PA11: USB DM line. Used in input no pull mode.
Page 264: Input/output     PA12: USB DP line. Used in input no pull mode.
Page 264: USB_DP pin
Page 265: Configure USB Device FS
Page 265: bootloader using USB
Page 265: USB cable               yes
Page 268: CRS is enabled for the DFU to allow USB to be
Page 270: USB FS configured in forced device mode.
Page 270: USB FS interrupt vector is enabled and used for
Page 270: USB                        Enabled          USB DFU communications.
Page 270: Note: VDDUSB IO must be connected to 3.3 V as
Page 270: DFU                                                                  USB peripheral is used by the bootloader.
Page 270: USB_DM pin                                  PA11: USB DM line. Used in input no pull mode.
Page 270: Input/output     PA12: USB DP line. Used in input no pull mode.
Page 270: USB_DP pin
Page 271: Configure USB Device FS
Page 271: bootloader using USB
Page 271: USB cable               yes
Page 273: RCC                                  CRS is enabled for the DFU to allow USB to be
Page 275: USB FS configured in forced device mode.
Page 275: USB                   Enabled        USB FS interrupt vector is enabled and used for
Page 275: USB DFU communications.
Page 275: PA11: USB DM line. Used in alternate push-pull, no
Page 275: DFU                USB_DM pin
Page 275: Input/output   PA12: USB DP line. Used in alternate push-pull, no
Page 275: USB_DP pin                           pull mode.
Page 275: USB FS configured in forced device mode.
Page 275: USB FS interrupt vector is enabled and used for
Page 275: USB                   Enabled        USB DFU communications.
Page 275: Note: VDDUSB IO must be connected to 3.3 V as
Page 275: DFU                                                     USB peripheral is used by the bootloader.
Page 275: USB_DM pin                           PA11: USB DM line. Used in input no pull mode.
Page 275: Input/output   PA12: USB DP line. Used in input no pull mode. No
Page 275: USB_DP pin
Page 276: Note:        USB special commands are slightly different from the other protocols as per the USB
Page 276: • Data are sent on USB frame by byte (LSB first). No need to add number of data to transmit
Page 276: • Returned data and status are formatted on the USB native protocol
Page 277: Configure USB FS                     I2C address          interrupt sources
Page 277: USB cable
Page 277: USB interrupts
Page 279: RCC                                   CRS is enabled for the DFU to allow USB to be
Page 281: USB FS configured in forced device mode.
Page 281: USB                   Enabled        USB FS interrupt vector is enabled and used for
Page 281: USB DFU communications.
Page 281: DFU                                                     PA11: USB DM line. Used in alternate push-pull, no
Page 281: USB_DM pin
Page 281: PA12: USB DP line. Used in alternate push-pull, no
Page 281: USB_DP pin
Page 283: Note:           USB special commands are slightly different from the other protocols as per the USB
Page 283: • Data are sent on USB frame by byte (LSB first). No need to add number of data to transmit
Page 283: • Returned data and status are formatted on the USB native protocol
Page 284: Configure USB FS                        I2C address          interrupt sources
Page 284: USB cable
Page 284: USB interrupts
Page 286: RCC                                 CRS is enabled for the DFU to allow USB to be clocked by
Page 288: USB FS configured in forced device mode.
Page 288: USB                  Enabled        USB FS interrupt vector is enabled and used for USB DFU
Page 288: PA11: USB DM line. Used in alternate push-pull, no pull
Page 288: DFU            USB_DM pin
Page 288: Input/output   PA12: USB DP line. Used in alternate push-pull, no pull
Page 288: USB_DP pin                          mode.
Page 288: USB FS configured in forced device mode.
Page 288: USB FS interrupt vector is enabled and used for USB DFU
Page 288: USB                  Enabled        communications.
Page 288: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 288: USB_DM pin                          PA11: USB DM line. Used in input no pull mode.
Page 288: Input/output   PA12: USB DP line. Used in input no pull mode.
Page 288: USB_DP pin
Page 289: Note:         USB special commands are slightly different from the other protocols as per the USB
Page 289: • Data are sent on USB frame by byte (LSB first). No need to add number of data to transmit
Page 289: • Returned data and status are formatted on the USB native protocol
Page 290: Configure USB FS                     I2C address          interrupt sources
Page 290: USB cable
Page 290: USB interrupts
Page 292: RCC                                 CRS is enabled for the DFU to allow USB to be clocked by
Page 295: USB FS configured in forced device mode.
Page 295: USB                   Enabled        USB FS interrupt vector is enabled and used for USB DFU
Page 295: PA11: USB DM line. Used in alternate push-pull, no pull
Page 295: DFU           USB_DM pin
Page 295: Input/output   PA12: USB DP line. Used in alternate push-pull, no pull
Page 295: USB_DP pin                           mode.
Page 296: USB OTG FS Device
Page 296: USB cable                                                       Execute DFU
Page 296: USB interrupts
Page 297: USB is wrong
Page 297: Level1, doing a reset or power on/off and the USB cable
Page 298: CRS is enabled for the DFU to allow USB to be
Page 301: USB FS configured in forced device mode.
Page 301: USB                   Enabled        USB FS interrupt vector is enabled and used for USB
Page 301: PA11: USB DM line. Used in alternate push-pull, no
Page 301: DFU                USB_DM pin
Page 301: Input/output   PA12: USB DP line. Used in alternate push-pull, no
Page 301: USB_DP pin                           pull mode.
Page 301: DFU mode does not support USBREGEN mode. If STM32 is powered by an 1.8 V source, it
Page 302: USB OTG FS Device
Page 302: USB cable                                                       Execute DFU
Page 302: USB interrupts
Page 303: – Switch USB clock input from HSE to HSI48
Page 303: interfaces. Only the USB is able to connect as it
Page 304: – Adjust USB, I2C erase and program timings          command.
Page 306: CRS is enabled for the DFU to allow USB to be clocked
Page 309: USB FS configured in forced device mode.
Page 309: USB                   Enabled        USB FS interrupt vector is enabled and used for USB
Page 309: DFU                                                  PA11: USB DM line. Used in alternate push-pull, no pull
Page 309: USB_DM pin
Page 309: PA12: USB DP line. Used in alternate push-pull, no pull
Page 309: USB_DP pin
Page 311: USB OTG FS device
Page 311: USB cable                                                       Execute DFU
Page 311: USB interrupts
Page 312: using USB is wrong (expected value 256 x 8 KB, but
Page 312: Fixes all issues of previous      USB cable is plugged.
Page 313: CRS is enabled for the DFU to allow USB to be clocked by
Page 316: USB FS configured in forced device mode.
Page 316: USB                    Enabled          USB FS interrupt vector is enabled and used for USB DFU
Page 316: DFU                                                      PM12: USB DM line. Used in alternate push-pull, no pull
Page 316: USB_DM pin
Page 316: PM11: USB DP line. Used in alternate push-pull, no pull
Page 316: USB_DP pin
Page 317: Special commands supported (USART/I2C/SPI/FDCAN/USB/I3C)
Page 318: Configure USB FS                       I2C address          interrupt sources
Page 318: USB cable
Page 318: USB interrupts
Page 330: •     V4.x supporting USART1, USART2 USART2, and DFU (USB FS device). This version
Page 331: USB FS configured in forced device mode. USB FS interrupt
Page 331: USB                  Enabled
Page 331: vector is enabled and used for USB DFU communications.
Page 331: PA11 pin: USB FS DM line. Used in alternate push-pull, no
Page 331: DFU             USB_DM pin
Page 331: PA12 pin: USB FS DP line. Used in alternate push-pull, no
Page 331: USB_DP pin
Page 333: Configure USB clock to 48
Page 333: Configure USB FS device
Page 333: USB cable
Page 333: using USB interrupts           for USARTx
Page 334: – The USB bootloader fails on some machines using a high speed
Page 334: De-synchronization between USB controller and bootloader SW due to the
Page 334: Add an USB HUB between the host and the MCU. This relaxes
Page 334: the task. Use USB controller/host that increase inter-packet delay.
Page 343: HSI enabled       USARTx and during USB detection for DFU
Page 343: The PLL is used to generate the USB
Page 344: USB                   Enabled               USB used in FS mode
Page 344: PA11: USB DM line. Used in input no pull
Page 344: USB_DM pin
Page 344: PA12: USB DP line. Used in input no pull
Page 344: USB_DP pin
Page 345: Configure USB
Page 345: USB cable
Page 345: interrupt sources                     USB clock to 48 MHz
Page 345: bootloader using USB
Page 346: – The USB bootloader fails on some machines using a high speed controller.
Page 346: Initial          De-synchronization between USB controller and bootloader SW due to the
Page 346: Add an USB HUB between the host and the MCU. This relaxes transactions
Page 346: USB controller/host that increase inter-packet delay.
Page 347: HSI enabled       USARTx and during USB detection for DFU
Page 347: The PLL is used to generate the USB
Page 348: USB                   Enabled               USB used in FS mode
Page 348: PA11: USB DM line. Used in alternate
Page 348: USB_DM pin
Page 348: PA12: USB DP line. Used in alternate push-
Page 348: USB_DP pin
Page 349: Configure USB
Page 349: USB cable                                                                                Generate System
Page 349: USARTx                                                  USB clock to 48 MHz
Page 349: bootloader using USB
Page 350: – The USB bootloader fails on some machines using a high speed
Page 350: De-synchronization between USB controller and bootloader SW due
Page 350: Add an USB HUB between the host and the MCU. This relaxes
Page 350: correctly the task. Use USB controller/host that increase inter-packet
Page 351: HSI enabled       USARTx and during USB detection for DFU
Page 351: The PLL is used to generate the USB
Page 352: USB                   Enabled               USB used in FS mode
Page 352: DFU                   USB_DM pin                                  PA11: USB DM line.
Page 352: USB_DP pin                                  PA12: USB DP line.
Page 353: Configure USB
Page 353: USB cable                                         USB clock to 48 MHz
Page 353: bootloader using USB
Page 354: – The USB bootloader fails on some machines using a high speed
Page 354: De-synchronization between USB controller and bootloader SW due to
Page 354: Add an USB HUB between the host and the MCU. This relaxes
Page 354: correctly the task. Use USB controller/host that increase inter-packet
Page 355: RCC                                      USB bootloader operation.
Page 355: CRS is enabled for the DFU to allow USB to be clocked
Page 357: USB FS configured in forced device mode.
Page 357: USB FS interrupt vector is enabled and used for USB
Page 357: USB                      Enabled            DFU communications.
Page 357: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 357: PA11: USB DM line. Used in alternate push-pull, no pull
Page 357: USB_DM pin
Page 357: Input/output       PA12: USB DP line. Used in alternate push-pull, no pull
Page 357: USB_DP pin                                  mode.
Page 357: Note:          If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be
Page 359: Configure USB Device FS
Page 359: bootloader using USB
Page 359: USB cable               yes
Page 361: The bootloader V9.1 version is updated to fix known limitations relative to USB-DFU
Page 361: and USB bootloader operation.
Page 361: CRS is enabled for the DFU to allow USB to be clocked
Page 364: USB FS configured in forced device mode.
Page 364: USB FS interrupt vector is enabled and used for USB
Page 364: USB                   Enabled        DFU communications.
Page 364: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 364: PA11: USB DM line. Used in alternate push-pull, no pull
Page 364: USB_DM pin
Page 364: Input/output   PA12: USB DP line. Used in alternate push-pull, no pull
Page 364: USB_DP pin                           mode.
Page 364: Note:       If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be
Page 366: Configure USB Device FS                   sources and other           sources and other                  Configure
Page 366: bootloader using USB         BL_CAN_Loop for
Page 366: USB cable
Page 367: – For the USB-DFU interface, the CRS (clock recovery system) is not
Page 367: correctly configured and this may lead to random USB
Page 369: HSI enabled     configured to 72 MHz and for USART, I2C, SPI and USB
Page 369: CRS is enabled for the DFU to allow USB to be clocked by
Page 372: USB FS configured in forced device mode.
Page 372: USB FS interrupt vector is enabled and used for USB DFU
Page 372: USB                  Enabled         communications.
Page 372: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 372: PA11: USB DM line. Used in alternate push-pull, no pull
Page 372: USB_DM pin
Page 372: Input/output    PA12: USB DP line. Used in alternate push-pull, no pull
Page 372: USB_DP pin                           mode.
Page 372: Note:       If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be
Page 374: Configure USB Device FS
Page 374: bootloader using USB         BL_CAN_Loop for
Page 374: USB cable
Page 376: •     V10.x supporting USART, I2C and DFU (USB FS device).
Page 376: •     V9.x supporting USART, I2C, SPI, CAN and DFU (USB FS device).
Page 376: The HSE is used only when the USB interface is selected and
Page 376: MHz as USB clock source. The LSE must be equal to
Page 376: instead if USB is connected.
Page 376: The MSI is configured to 48 MHz and is used as USB clock
Page 376: HSE is used if USB is connected.
Page 378: USB                  Enabled        USB OTG FS configured in forced device mode
Page 378: USB_DM pin                          PA11: USB DM line. Used in alternate push-pull, no pull mode.
Page 378: Input/output   PA12: USB DP line. Used in alternate push-pull, no pull mode.
Page 378: DFU               USB_DP pin
Page 378: USB bootloader (DFU) requires either an LSE (low-speed external clock) or a HSE (high-
Page 378: source of the USB. The system clock is kept clocked to 24 MHz by the HSI.
Page 378: •     If the HSE is present, the system clock and USB clock are configured, respectively, to
Page 380: Configure USB clock to 48
Page 380: Configure USB clock to 48
Page 380: Configure USB OTG FS           yes
Page 380: MSI used as USB
Page 380: USB cable                                                                          Generate System
Page 380: to 24 MHz and USB clock
Page 380: using USB interrupts
Page 381: Add support of MSI as USB clock
Page 382: The HSE is used only when the USB interface is selected
Page 382: System is clocked at 72 MHz if USB is used or 60 MHz if
Page 382: MHz as USB clock source. The LSE must be equal to
Page 382: instead if USB is connected.
Page 382: The MSI is configured to 48 MHz and is used as USB clock
Page 382: HSE is used if USB is connected.
Page 384: USB FS configured in forced device mode. USB FS
Page 384: interrupt vector is enabled and used for USB DFU
Page 384: USB                       Enabled         communications.
Page 384: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 384: PA11 pin: USB FS DM line. Used in alternate push-pull, no
Page 384: USB_DM pin
Page 384: PA12 pin: USB FS DP line. Used in alternate push-pull, no
Page 384: USB_DP pin
Page 385: If the HSE is present, the system clock and USB clock are configured, respectively, to 72
Page 385: Note:            If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be
Page 386: Configure USB clock to 48 MHz
Page 386: Configure USB clock to 48 MHz with HSI
Page 386: Configure USB OTG FS device                     Disable all interrupt                                        Disable all interrupt sources
Page 386: MSI used as USB clock
Page 386: no            USB cable                                 clock to 60 MHz
Page 386: to 72 MHz and USB clock
Page 386: for CANx                                    using USB interrupts
Page 387: USART/I2C/CAN/USB.
Page 388: CRS is enabled for the DFU to allow USB to be clocked by
Page 391: USB OTG FS configured in forced device mode.
Page 391: USB OTG FS interrupt vector is enabled and used for USB
Page 391: USB                  Enabled        DFU communications.
Page 391: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 391: PA11: USB DM line. Used in alternate push-pull, no pull
Page 391: USB_DM pin
Page 391: PA12: USB DP line. Used in alternate push-pull, no pull
Page 391: USB_DP pin
Page 391: Note:         If VDDUSB pin is not connected to VDD, SPI flash memory write operations may be
Page 393: Configure USB OTG FS using
Page 393: bootloader using USB        BL_CAN_Loop for
Page 393: USB cable                  yes
Page 395: HSI enabled    configured to 60 MHz and for USART, I2C, SPI and USB
Page 395: CRS is enabled for the DFU to allow USB to be clocked by
Page 398: USB FS configured in forced device mode.
Page 398: USB FS interrupt vector is enabled and used for USB DFU
Page 398: USB                  Enabled        communications.
Page 398: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 398: PA11: USB DM line. Used in alternate push-pull, no pull
Page 398: USB_DM pin
Page 398: PA12: USB DP line. Used in alternate push-pull, no pull
Page 398: USB_DP pin
Page 400: Configure USB Device FS
Page 400: USB cable                                    Execute DFU             Execute
Page 400: USB interrupts         for CANx
Page 402: HSI enabled      configured to 60 MHz and for USART, I2C, SPI and USB
Page 402: CRS is enabled for the DFU to allow USB to be clocked by
Page 405: USB FS configured in forced device mode.
Page 405: USB FS interrupt vector is enabled and used for USB DFU
Page 405: USB                  Enabled         communications.
Page 405: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 405: USB_DM pin                           PA11: USB DM line.
Page 405: Input/output    PA12: USB DP line
Page 405: USB_DP pin
Page 407: Configure USB Device FS
Page 407: USB cable                                    Execute DFU             Execute
Page 407: USB interrupts         for CANx
Page 409: RCC                                CRS is enabled for the DFU to allow USB to be clocked by HSI
Page 412: USB FS configured in forced device mode.
Page 412: USB FS interrupt vector is enabled and used for USB DFU
Page 412: USB                   Enabled      communications.
Page 412: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 412: USB_DM pin                         PA11: USB DM line. Used in input no pull mode.
Page 412: Input/output PA12: USB DP line. Used in input no pull mode.
Page 412: USB_DP pin
Page 412: Note:          USB special commands are slightly different from the other protocols as per the USB
Page 412: •     Data are sent on USB frame byte per byte. No need to add number of data to be
Page 412: •     Returned data and status are formatted on the USB native protocol
Page 413: Configure USB OTG FS
Page 413: Synchro mechanism                yes                            bootloader using USB
Page 413: USB cable             yes
Page 414: – OB launch not working on USB-DFU
Page 414: – Support of sales type 256 KB   – Go command on USB is not working
Page 419: CRS is enabled for the DFU to allow USB
Page 421: USB FS configured in forced device
Page 421: USB FS interrupt vector is enabled and
Page 421: USB                  Enabled                   used for USB DFU communications.
Page 421: Note: VDDUSB IO must be connected to
Page 421: 3.3 V as USB peripheral is used by the
Page 421: PA11: USB DM line. Used in input no pull
Page 421: USB_DM pin
Page 421: Input/output              PA12: USB DP line. Used in input no pull
Page 421: USB_DP pin                                     mode.
Page 422: Configure USB Device FS
Page 422: USB cable                                 bootloader using
Page 422: Detected                                   USB interrupts
Page 428: Enabled only when USB cable detected.
Page 428: HSE must be 32 MHz to have the USB working.
Page 429: USB configured in device mode. USB interrupt vector is
Page 429: USB                  Enabled
Page 429: DFU           USB_DM pin                          PD7: USB DM line. Used in alternate function, no pull mode.
Page 429: Input/output   PD6: USB DP line. Used in alternate function, no pull mode.
Page 429: USB_DP pin
Page 430: Note:          USB special commands are slightly different from the other protocols as per the USB
Page 430: •     Data are sent on USB frame byte per byte. No need to add the number of data to be
Page 430: •     Returned data and status are formatted on the USB native protocol
Page 431: Configure USB
Page 431: Stop, DeInit USB
Page 431: USB cable                                               Quartz
Page 431: System and USB
Page 431: USB interrupts
Page 448: bootloader to allow USB to be clocked by HSI48 48 MHz
Page 450: USB configured in device mode. USB interrupt vector is
Page 450: USB                     Enabled
Page 450: enabled and used for USB DFU communications.
Page 450: PA11: USB DM line. Used in additional function mode,
Page 450: DFU               USB_DM pin
Page 450: PA12: USB DP line. Used in additional function mode,
Page 450: USB_DP pin
Page 451: PLL and HSI48 for USB
Page 451: Configure USB FS                        No
Page 451: USB cable
Page 451: USB interrupts
Page 453: CRS is enabled for the DFU so that USB can be clocked by
Page 456: USB configured in device mode.
Page 456: USB                     Enabled            USB interrupt vector is enabled and used for DFU
Page 456: DFU                                                        PA11: USB DM line. Used in alternate function with no pull
Page 456: USB_DM pin
Page 456: PA12: USB DP line. Used in alternate function with no pull
Page 456: USB_DP pin
Page 457: Note:         USB special commands are slightly different from the other protocols as per the USB
Page 457: •    Data are sent on USB frame byte per byte. No need to add number of data to be
Page 457: •    Returned data and status are formatted on the USB native protocol
Page 458: Configure USB                                             Disable all
Page 458: USB cable
Page 458: USB interrupts
Page 460: RCC                                     CRS is enabled for the DFU so that USB can be clocked by
Page 463: USB FS configured in forced device mode.
Page 463: USB                    Enabled              USB FS interrupt vector is enabled and used for USB DFU
Page 463: USB_DM pin                                  PA11: USB DM line. Used in input no pull mode.
Page 463: Input/output         PA12: USB DP line. Used in input no pull mode.
Page 463: USB_DP pin
Page 463: Note:         USB special commands are slightly different from the other protocols as per the USB
Page 463: •      Data are sent on USB frame byte per byte. No need to add number of data to be
Page 463: •      Returned data and status are formatted on the USB native protocol
Page 464: Configure USB FS
Page 464: USB cable               interrupt sources
Page 464: USB interrupts
Page 466: RCC                                   CRS is enabled for the DFU so that USB can be clocked by
Page 469: USB FS configured in forced device mode.
Page 469: USB FS interrupt vector is enabled and used for USB DFU
Page 469: USB                  Enabled              communications.
Page 469: Note: VDDUSB IO must be connected to 3.3 V as USB
Page 469: USB_DM pin                                PA11: USB DM line. Used in input no pull mode.
Page 469: Input/output         PA12: USB DP line. Used in input no pull mode.
Page 469: USB_DP pin
Page 469: Note:         USB special commands are slightly different from the other protocols as per the USB
Page 469: •    Data are sent on USB frame byte per byte. No need to add number of data to be
Page 469: •    Returned data and status are formatted on the USB native protocol
Page 470: Configure USB FS
Page 470: USB cable               interrupt sources
Page 470: USB interrupts
Page 472: RCC                              When USB cable is detected, SW tries to detect if a quartz is
Page 472: plugged in the board to configure the USBPHY clock.
Page 474: USB HS configured in forced device mode.
Page 474: USB                  Enabled        USB HS interrupt vector is enabled and used for USB DFU
Page 474: USB_DM pin                          PA11: USB DM line. Used in input no pull mode.
Page 474: Input/output   PA12: USB DP line. Used in input no pull mode.
Page 474: USB_DP pin
Page 475: Note:         USB special commands are slightly different from the other protocols as per the USB
Page 475: •       Data are sent on USB frame byte per byte. No need to add number of data to be
Page 475: •       Returned data and status are formatted on the USB native protocol
Page 476: USB HS device                                                             Disable all
Page 476: USB cable                         USB IP, and
Page 476: FDCANx                                       USB clocks                      detected?
Page 476: USB interrupts
Page 477: RCC                              When USB cable is detected, SW tries to detect if a quartz is
Page 477: plugged in the board to configure the USBPHY clock.
Page 479: USB HS configured in forced device mode. USB HS interrupt
Page 479: USB                   Enabled
Page 479: vector is enabled and used for USB DFU communications.
Page 479: DFU           USB_DM pin                           PA11: USB DM line. Used in input no pull mode.
Page 479: Input/output   PA12: USB DP line. Used in input no pull mode.
Page 479: USB_DP pin
Page 480: Note:          USB special commands are slightly different from the other protocols as per the USB
Page 480: •     Data are sent on USB frame byte per byte. No need to add number of data to be
Page 480: •     Returned data and status are formatted on the USB native protocol
Page 481: USB HS device                                                             Disable all
Page 481: USB cable                         USB IP, and
Page 481: FDCANx                                       USB clocks                      detected?
Page 481: USB interrupts
Page 493: Note:      The PA9 pin (USB_VBUS) on STM32F105xx/107xx devices is used to detect the USB host
Page 493: connection. The initialization of USB peripheral is performed only if PA9 is high at detection
Page 493: phase, which means that a host is connected to the port and delivering 5 V on the USB bus.
Page 493: the USB peripheral. To minimize bootloader detection time when PA9 pin is not used, keep
Page 495: 93.3       USB connection timing
Page 495: This is the time that the host must wait for between plugging the USB cable and establishing
Page 495: configuration. The USB connection depends upon the host.
Page 496: Figure 123. USB connection timing description
Page 496: Table 211. USB bootloader minimum timings (ms)
Page 496: Device                                                   USB connection
Page 497: Table 211. USB bootloader minimum timings (ms) (continued)
Page 497: Device                          USB connection
Page 498: Table 211. USB bootloader minimum timings (ms) (continued)
Page 498: Device                                                      USB connection
Page 507: 21-Feb-2019       36       Table 211: USB bootloader minimum timings (ms), Table 212: I2C bootloader minimum
Page 507: USART bootloader minimum timings (ms), Table 211: USB bootloader minimum
Page 507: timings (ms), Table 210: USART bootloader minimum timings (ms), Table 211: USB
Page 507: timings (ms), Table 211: USB bootloader minimum timings (ms), Table 212: I2C
Page 508: 05-Dec-2019       42       timings (ms), Table 211: USB bootloader minimum timings (ms), Table 212: I2C
Page 509: USB bootloader minimum timings (ms) and Table 212: I2C bootloader minimum timings
Page 511: Table 211: USB bootloader minimum timings (ms), Table 212: I2C bootloader
Page 512: 21-Feb-2023       57       (ms), Table 210: USART bootloader minimum timings (ms), Table 211: USB
Page 512: 04-Apr-2023       58       Table 210: USART bootloader minimum timings (ms), Table 211: USB bootloader
